# ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ: ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Monthly Excel Report (GENMATSU) üìä

‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏≤‡∏á‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Monthly Production Report ‡∏ã‡∏∂‡πà‡∏á‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡πÑ‡∏•‡∏ô‡πå‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï (Line A-D ‡πÅ‡∏•‡∏∞ Line R) ‡∏°‡∏≤‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß

---

## 1. ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö (System Overview)

- **Input**: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 1 ‡∏ñ‡∏∂‡∏á‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)
- **Process**: ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -> ‡πÅ‡∏õ‡∏•‡∏á‡∏™‡∏†‡∏≤‡∏û‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Mapping) -> ‡∏£‡∏ß‡∏°‡∏Å‡∏•‡∏∏‡πà‡∏° (Aggregation) -> ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö (Styling)
- **Output**: ‡πÑ‡∏ü‡∏•‡πå Excel (`.xlsx`) ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏£‡∏≤‡∏ü‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏ú‡∏•‡∏¥‡∏ï

---

## 2. ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡πÅ‡∏•‡∏∞‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ (Tech Stack & Libraries) üõ†Ô∏è

‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ Node.js Backend ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ‡∏´‡∏•‡∏±‡∏Å‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

| Library           | Version   | ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å                                                                             |
| :---------------- | :-------- | :-------------------------------------------------------------------------------------- |
| **exceljs**       | `^4.4.0`  | ‡πÉ‡∏ä‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå Excel, ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Worksheet, ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•, ‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î Styling (‡∏™‡∏µ, ‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö, ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏≤) |
| **quickchart-js** | `^3.1.3`  | ‡πÉ‡∏ä‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Å‡∏£‡∏≤‡∏ü (Bar Chart) ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡πÑ‡∏õ‡∏ù‡∏±‡∏á (Embed) ‡∏•‡∏á‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå Excel            |
| **mssql**         | `^10.0.1` | ‡πÉ‡∏ä‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á SQL Query ‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• SQL Server                              |

---

## 3. ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Data Sources & Mapping) üóÑÔ∏è

‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å 2 ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏°‡∏≤‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á **SQL UNION ALL**:

### 3.1 ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å

1.  **Form_Submissions (Standard)**: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏õ‡∏Å‡∏ï‡∏¥ (Line A, B)
2.  **Form_Ironpowder_Submissions (Ironpowder)**: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï Recycle (Line R)
3.  **Gen_StandardPlan_MT**: ‡∏ï‡∏≤‡∏£‡∏≤‡∏á Master Plan ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (Target/Plan)

### 3.2 ‡∏Å‡∏≤‡∏£ Mapping ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (SQL Logic)

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å 2 ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∂‡∏á‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Map ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

| Excel Column     | Standard (Form_Submissions) | Line R (Form_Ironpowder_Submissions) | ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏                                                                               |
| :--------------- | :-------------------------- | :----------------------------------- | :------------------------------------------------------------------------------------- |
| **Date**         | `d.production_date`         | `ip.report_date`                     |                                                                                        |
| **Lot No.**      | `s.lot_no`                  | `ip.lot_no`                          |                                                                                        |
| **Line**         | `s.production_line`         | `'Line R'` (Fix ‡∏Ñ‡πà‡∏≤)                 |                                                                                        |
| **Product Type** | `s.form_type`               | `ip.machine_name`                    | **Line R ‡πÉ‡∏ä‡πâ Machine Name ‡πÅ‡∏ó‡∏ô Type**                                                   |
| **Input (kg)**   | `d.input_kg`                | `ip.total_input`                     |                                                                                        |
| **Output (kg)**  | `d.output_kg`               | `ip.total_genmatsu_a`                | **Line R ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤ Genmatsu A ‡πÄ‡∏õ‡πá‡∏ô Output**                                               |
| **Plan (kg)**    | `d.st_target_value`         | `mt.target_value`                    | Line R Join ‡∏à‡∏≤‡∏Å StandardPlan ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ MachineName                                        |
| **Mix Recycle**  | `d.AZ_RGenmatsu`            | `0` (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤)                       | ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå `AZ_RGenmatsu` ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á `Form_Submission_Data` (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠ 6 Feb 2026) |
| **Mix NCR**      | `Plan - StandardPlan`       | `0` (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤)                       | ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å Plan - Standard Target                                                |

---

## 4. ‡∏•‡∏≠‡∏à‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (Core Logic) üß†

### 4.1 ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Aggregation)

‡πÑ‡∏ü‡∏•‡πå `excel.service.js` ‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Group ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Key:
`Date` + `Short Lot` + `Line` + `Product Name`

- **Short Lot**: ‡∏ï‡∏±‡∏î‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 4 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á Lot No. (‡πÄ‡∏ä‡πà‡∏ô `6026C1` -> `6026`) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Line R ‡∏ó‡∏µ‡πà‡∏°‡∏µ 4 ‡∏´‡∏•‡∏±‡∏Å‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß (`6023`) ‡∏Å‡πá‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏•‡∏¢
- **Line**: ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ó‡∏µ‡πà 5 ‡∏Ç‡∏≠‡∏á Lot ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å DB (‡∏Å‡∏£‡∏ì‡∏µ Line R)
- **Batch Count**: ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Record (1 Record = 1 Batch)

### 4.2 ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÜ

- **% Yield**: `(Output / Input) * 100`
- **Mix NCR**: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å SQL (`d.st_target_value - mt.target_value`)
- **Mix Recycle**: ‡∏î‡∏π‡∏î‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å `AZ_RGenmatsu` ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á `Form_Submission_Data`

### 4.3 ‡∏Å‡∏≤‡∏£‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á (Styling) üé®

- **Theme**: Corporate Blue (‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏° ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏Ç‡∏≤‡∏ß)
- **Zebra Striping**: ‡∏™‡∏•‡∏±‡∏ö‡∏™‡∏µ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î (‡∏Ç‡∏≤‡∏ß/‡πÄ‡∏ó‡∏≤‡∏≠‡πà‡∏≠‡∏ô) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢
- **Conditional Formatting**:
  - **Yield**: ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß (‚â• 98%), ‡∏™‡∏µ‡πÅ‡∏î‡∏á (< 95%)
  - **NCR/Scrap**: ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏µ‡πÅ‡∏î‡∏á ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0
- **Clean Look**: ‡∏ã‡πà‡∏≠‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô 0 ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á

---

## 6. ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡πâ‡∏≤ (Frontend Integration) üíª

‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏° **Export Excel** ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ `ProductionReportPage.tsx` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ‡∏™‡∏∞‡∏î‡∏ß‡∏Å

### 6.1 API Endpoint

- **URL**: `/api/reports/export-excel`
- **Method**: `GET`
- **Params**: `month` (Format: `YYYY-MM`)
- **Response**: `Blob` (Binary File Type: `application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`)

### 6.2 ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á Button

1.  ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Date Picker
2.  ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Service `exportMonthlyReport(month)`
3.  ‡∏£‡∏±‡∏ö Blob Response ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á Temporary Link (`window.URL.createObjectURL`)
4.  Auto-click Link ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå `.xlsx`

---

## 7. ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á (Related Files) üìÇ

| Path                                                  | ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î                                                             |
| :---------------------------------------------------- | :--------------------------------------------------------------------- |
| `backend/src/controllers/report.controller.js`        | ‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏´‡∏•‡∏±‡∏Å, ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô SQL Query, ‡∏ó‡∏≥ Union ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•, ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ Service |
| `backend/src/services/excel.service.js`               | ‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå Excel, ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Grouping, ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü, ‡πÅ‡∏•‡∏∞‡πÉ‡∏™‡πà Styling         |
| `backend/src/api/report.routes.js`                    | ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Endpoint ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Export Excel (`/export-excel`)                   |
| `frontend/src/pages/Reports/ProductionReportPage.tsx` | UI ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å ‡∏°‡∏µ‡∏õ‡∏∏‡πà‡∏° Export Excel ‡πÅ‡∏•‡∏∞ Download PDF                       |
| `frontend/src/services/submissionService.ts`          | Service ‡∏ù‡∏±‡πà‡∏á Frontend ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API                                  |

---

_‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏â‡∏ö‡∏±‡∏ö‡∏ô‡∏µ‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÄ‡∏°‡∏∑‡πà‡∏≠: 10 ‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå 2026_
_‡∏ú‡∏π‡πâ‡∏û‡∏±‡∏í‡∏ô‡∏≤: AI Assistant (Antigravity)_
